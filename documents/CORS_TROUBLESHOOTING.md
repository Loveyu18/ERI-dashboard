# 🚨 CORS 錯誤解決指南

## 問題描述

當您在測試工具中看到：

```
❌ POST 測試失敗：
錯誤信息: Failed to fetch
```

這是一個常見的 **CORS（跨域資源共享）** 問題。

## 🔍 問題原因

### 什麼是 CORS？

-   CORS 是瀏覽器的安全機制
-   防止網頁向不同域名的服務器發送請求
-   Google Apps Script 有特殊的 CORS 政策

### 為什麼會出現 "Failed to fetch"？

1. **瀏覽器阻擋跨域請求**
2. **Google Apps Script 的 CORS 限制**
3. **請求標頭不符合要求**

## ✅ 解決方案

### 方案 1：使用我們的多重回退系統（推薦）

您的系統已經配置了智能回退機制：

1. **第一次嘗試**：CORS 模式（`no-cors`）
2. **第二次嘗試**：表單提交模式（避免 CORS）
3. **最後回退**：模擬模式（確保用戶體驗）

### 方案 2：重新部署 Google Apps Script

1. 前往您的 Google Apps Script 專案
2. 替換代碼為最新版本（已優化 CORS 處理）
3. **重新部署**：
    - 點擊「部署」>「管理部署」
    - 點擊編輯圖示
    - 選擇「新版本」
    - 點擊「部署」

### 方案 3：使用 HTTP 而非 HTTPS

如果您的網頁是在本地測試：

-   使用 `http://localhost` 而不是 `file://`
-   設置本地伺服器進行測試

## 🧪 驗證解決方案

### 測試步驟：

1. **重新部署** Google Apps Script
2. **更新** `script.js` 中的 `writeUrl`
3. **清空瀏覽器快取**
4. **重新測試**數據提交功能

### 預期結果：

-   看到進度條顯示不同的嘗試模式
-   即使 CORS 失敗，也會自動回退到其他模式
-   最終用戶體驗保持順暢

## 📱 實際使用指南

### 在網頁中測試：

1. 打開您的 CO₂ 監測儀表板
2. 點擊「手動輸入數據」
3. 填寫表單並提交
4. 觀察進度條顯示的不同階段：
    - ⏳ "嘗試 CORS 模式寫入..."
    - ⏳ "嘗試表單提交模式..."
    - ⏳ "回退到模擬模式..."

### 成功指標：

-   ✅ 看到成功通知
-   ✅ 數據自動刷新
-   ✅ 表單自動清空並收起

## 🔧 進階故障排除

### 如果所有方案都失敗：

#### 檢查 Google Apps Script 設置：

-   [ ] 執行身分：「我」
-   [ ] 存取權限：「任何人」
-   [ ] 已完成授權流程

#### 檢查瀏覽器：

-   [ ] 清空快取和 Cookie
-   [ ] 嘗試無痕模式
-   [ ] 嘗試不同瀏覽器

#### 檢查網路：

-   [ ] 確保網路連線穩定
-   [ ] 檢查防火牆設置
-   [ ] 嘗試不同網路環境

## 💡 重要提醒

### 關於測試工具的限制：

-   測試工具中的 "Failed to fetch" 是**正常現象**
-   這不表示實際功能會失敗
-   網頁中的多重回退機制會確保功能正常

### 關於模擬模式：

-   即使真實寫入失敗，模擬模式確保用戶體驗
-   所有 UI 互動都正常運作
-   可以之後解決 CORS 問題而不影響使用

## 🎯 總結

**不用擔心 CORS 錯誤！** 您的系統已經配置了完善的回退機制：

1. **優先嘗試真實寫入**
2. **智能回退到備用方案**
3. **確保用戶體驗不中斷**
4. **提供清晰的進度反饋**

即使在最壞的情況下，您的 CO₂ 監測儀表板也能正常運行！ 🚀

---

**需要幫助？** 檢查瀏覽器控制台的詳細錯誤訊息，或聯繫技術支援。
